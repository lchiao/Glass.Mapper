


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from www.glass.lu/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 10:13:45 GMT -->
<!-- Added by HTTrack -->

<!-- Mirrored from glass.lu/blog/MixingInIoc by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:22:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <link rel="stylesheet" href="../content/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../content/css/style.css">
    <link rel="stylesheet" href="../content/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../content/css/theme-colors/default.css">
    <link rel="stylesheet" href="../content/plugins/sky-forms/version-2.0.1/css/custom-sky-forms.css">

    <link rel="stylesheet" href="../content/plugins/parallax-slider/css/parallax-slider.css">

    <link rel="stylesheet" href="../content/Site-Lessae52ae52.css?v=5" />
    <link rel="stylesheet" href="../content/site.css">

    <title>Mixing in IOC containers - Glass</title>

    <link rel="shortcut icon" href="../-/media/Images/Common/Horizon-Bordered-BlazeOrange-250.png">
    <!-- JS Global Compulsory -->
    <script type="text/javascript" src="../content/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../content/plugins/jquery/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="../content/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../content/Site.js"></script>
    <script src="../google-code-prettify.googlecode.com/svn/loader/run_prettify.html"></script>
    <script type="text/javascript" src="../content/plugins/parallax-slider/js/modernizr.js"></script>
    <script type="text/javascript" src="../content/plugins/parallax-slider/js/jquery.cslider.js"></script>


</head>


<body class="metro  mvc ">

    <div class="wrapper">

        <div class="header header-sticky header-fixed-shrink">
            <div class="topbar">
            </div>

            <!-- Navbar -->
            <div class="navbar navbar-default mega-menu" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="fa fa-bars"></span>
                        </button>
                        <a class="navbar-brand" href="../index.html">

                            <img src="../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                            <span style="vertical-align: middle;">Glass</span>

                        </a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse navbar-responsive-collapse">
                        <ul class="nav navbar-nav">

                            <li class="">

                                <a href="../Support.html">Support</a>
                            </li>
                            <li class="">

                                <a href="../Training.html">Training</a>
                            </li>
                            <li class="">

                                <a href="../Blog.html">Blog</a>
                            </li>
                            <li class="">

                                <a href="../Mapper.html">Glass.Mapper.Sc</a>
                            </li>
                            <li class="">

                                <a href="../Rockstars.html">Our Backers</a>
                            </li>
                            <li class="">

                                <a href="../About.html">About</a>
                            </li>
                        </ul>
                    </div><!--/navbar-collapse-->
                </div>
            </div>
            <!-- End Navbar -->
        </div>

            <div class="breadcrumbs">
                <div class="container">
                    <h1 class="pull-left">

Blog -                         Mixing in IOC containers

                    </h1>

                </div><!--/container-->
            </div>

        


<div class="container content">
    <div class="row padding-bottom-20">
        <p>
            <strong>
                <a href="../blog-2.html">&lt;&lt; Back to Blogs</a>
            </strong>
        </p>
    </div>
    <div class="row">


        
 

        
<div>
    
</div>
<div class="row">
    <div class="col-md-12">

        <div class="blog margin-bottom-40">
            <div class="blog-post-tags">
                <ul class="list-unstyled list-inline blog-info pull-right">
                    <li>
                        <h3>
                            <i class="fa fa-calendar"></i>
                            08 Aug 2013
                        </h3>
                    </li>

                        <li>
                            <h3>
                                <a href="../About/Mike.html">
                                    <i class="fa fa-pencil"></i>
                                    Mike
                                </a>
                            </h3>
                        </li>
                </ul>
            </div>
        </div>
    </div>
</div>

            <img src="../-/media/Images/Blogs/20130808DependencyInversionPrinciplecca2cca2.jpg?h=160&amp;w=200&amp;la=en&amp;hash=63474861298227683EC592EAB68BA052626F59DD" class="pull-right img-responsive img-bordered margin-bottom-10 margin-left-10" alt="">
    




<p class="lead">
I had a question yesterday about how to get a different IOC container to create objects that are used by Glass.Mapper rather than the default
inbuilt Glass.Mapper method or using Castle Windsor. In this post I will show how this can be achieved and how simple the process is.
</p>
<p>
I am going to be using SimpleInjector as the other IOC container that should create objects in Glass.Mapper. The first thing to do
is to set it up, after downloading the SimpleInjector Nuget package I need to create an instance of the container in the Global class
when the application starts:
</p>
<pre class="csharp">    public class Global : Sitecore.Web.Application
    {
        public static Container Container { get; private set; }

        public void Application_Start()
        {
            Global.Container = new Container();

            Global.Container.Register&lt;ISimpleService, SimpleService&gt;();
        }
    }
</pre>
<p>
Notice that the container is assigned to the static Container property, this is important because this allows us to access the container later. I have
also registered a single service with the container. It is a very simple service and will be used just to prove that the dependency was injected. The
implementation for the service is:
</p>
<pre class="csharp">    public class SimpleService : ISimpleService
    {
        public string DoWork()
        {
            return "Some work was done";
        }
    }
    public interface ISimpleService
    {
        string DoWork();
    }
</pre>
<p>
Next I need to define my model that will use both the service but also pull data from Sitecore. In the model I want Path, Name and Title to be pulled from
Sitecore:
</p>
<pre class="csharp">    public class SimpleModel
    {
        private readonly ISimpleService _service;

        public SimpleModel(ISimpleService service)
        {
            _service = service;
        }

        public virtual string SomeValue { get { return _service.DoWork(); } }

        public virtual string Path { get; set; }
        public virtual string Name { get; set; }
        public virtual string Title { get; set; }

    }
</pre>
<p>
I have everything setup now for SimpleInjector, now I need to tell Glass.Mapper how to use it. Glass.Mapper makes uses of pipelines to do certain tasks,
the available pipelines are:
</p>
<ul>
    <li>Configuration Resolver - Used to determine which type configuration to use when loading an object.</li>
    <li>DataMapper Resolver - Determines which data mapper will be used for a property.</li>
    <li>Object Construction - Used to build requested objects.</li>
    <li>Object Saving - Called when an object is saved or created.</li>
</ul>
<p>
We are obviously trying to override how objects are created so we will need to hook into the Object Construction pipeline. To do this we need to create
a task that inherits the <strong>Glass.Mapper.Pipelines.ObjectConstruction.IObjectConstructionTask</strong> interface:
</p>
<pre class="csharp">    public class SimpleInjectorTask : Glass.Mapper.Pipelines.ObjectConstruction.IObjectConstructionTask
    {
        private static object _lock = new object();

        public void Execute(Glass.Mapper.Pipelines.ObjectConstruction.ObjectConstructionArgs args)
        {
            //check that no other task has created an object
            //also check that this is a dynamic object
            if (args.Result == null &amp;&amp; !args.Configuration.Type.IsAssignableFrom(typeof(IDynamicMetaObjectProvider)))
            {
                //check to see if the type is registered with the SimpleInjector container
                //if it isn't added it
                if (Global.Container.GetRegistration(args.Configuration.Type) == null)
                {
                    lock (_lock)
                    {
                        if (Global.Container.GetRegistration(args.Configuration.Type) == null)
                        {
                            Global.Container.Register(args.Configuration.Type);
                        }
                    }
                }

                //create instance using SimpleInjector
                var obj = Global.Container.GetInstance(args.Configuration.Type);

                //map properties from item to model
                args.Configuration.MapPropertiesToObject(obj, args.Service, args.AbstractTypeCreationContext);

                //set the new object as the returned result
                args.Result = obj;
            }
        }
    }
</pre>
<p>
Read through the comments to understand exactly what is going on but in summary it checks to see if the type is registered with the SimpleInjector container
and if not it registers it, of course you could register all your types beforehand if you wanted. It the gets the SimpleInjector container to create an
instance before mapping the properties onto the new object.
</p>
<p>
Finally we need to make the Glass.Mapper aware that we have created this new task. To do this open the class /App_Start/GlassMapperScCustom.cs and
update the CastleConfig method ensuring that you register the custom task before the SitecoreInstaller is added:
</p>
<pre class="csharp">		    public static void CastleConfig(IWindsorContainer container){
			    var config = new Config();

                container.Register(
                   Component.For&lt;IObjectConstructionTask&gt;().ImplementedBy&lt;SimpleInjectorTask&gt;().LifestylePerWebRequest()
                  );
		      //  config.EnableCaching = false;

			    container.Install(new SitecoreInstaller(config));
		    }
</pre>
<p>
We have now done everything we need to do to get SimpleInjector working with Glass.Mapper, we can now make a request for our model:
</p>
<pre class="csharp">    var service = new SitecoreService("master");
    var model = service.GetItem&lt;SimpleModel&gt;("/sitecore/content/home/demo");
    
    var work = model.SomeValue; //returns Some work was done
    var path = model.Path; //returns /sitecore/content/home/demo
</pre>
<p>
Hopefully this post has shown how simple it is to extend Glass.Mapper and how it plays nicely with other IOC containers. If you have any questions
please contact me.
</p>

    


    </div>

    <div class="row">
        <div class="row">
    <div class="devider devider-dashed margin-top-30 margin-bottom-30"></div>

    <div class="col-md-8">

        <div class="headline">
            <h2 class="">Glass needs your support!</h2>
        </div>

        <p>
            Glass.Mappper.Sc is supported by the generous donations of the Glass.Mapper.Sc community! Their donations help fund the time, effort and hosting for the project.
        </p>
        <p>
            These supporters are <strong>AMAZING</strong> and a huge thank you to all of you. You can find our list of supporters on the <a href="../rockstars-2.html">Rockstars page</a>.
        </p>
        <p>
            If <strong>you</strong> use Glass.Mapper.Sc and find it useful please consider supporting the project. Not only will you help the project but you could also get a discount on the
            Glass.Mapper.Sc training and join the Rockstars page.
        </p>

        <p class="text-center">
            <a href="https://www.patreon.com/glassmappersc" class="btn-u btn-u-lg" style="margin: 10px;">
                <em class=" fa fa-star icon-bg-darker"></em>
                Become a Rockstar
            </a>
        </p>

    </div>
    <div class="col-md-4 text-center">
        <img src="../Images/Blog/WeNeedYou.jpg" style="max-height:300px"/>
    </div>
</div>

        </div>
    </div>


        <div class="footer-v1">
            <div class="footer">
                <div class="container">
                    <div class="row">
                        <!-- About -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="row text-center margin-bottom-10 margin-top-20">
                                <a href="../index.html" class="">
                                    <img src="../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                                </a>
                            </div>

                            <p>Glass is home to the #1 ORM for Sitecore. Glass.Mapper is the easiest way to map data from your Sitecore solution to your code.</p>
                        </div><!--/col-md-3-->
                        <!-- End About -->
                        <!-- Latest -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Sponsored by</h2>
                            </div>
                            <a href="https://refractdns.com/">
                                <img src="../-/media/Images/Tiles/RDNS_Logo_WithTextWhite.png" style="width: 100%" class="img-responsive">
                            </a>
                        </div><!--/col-md-3-->
                        <!-- End Latest -->
                        <!-- Link List -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Useful Links</h2>
                            </div>
                            <ul class="list-unstyled link-list">
                                <li><a href="../Blog.html">Blog</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../Training.html">Training</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../Mapper.html">Glass.Mapper.Sc</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../Support.html">Support</a><i class="fa fa-angle-right"></i></li>
                            </ul>
                        </div><!--/col-md-3-->
                        <!-- End Link List -->
                        <!-- Address -->
                        <div class="col-md-3 map-img md-margin-bottom-40">
                            <div class="headline">
                                <h2>Contact Us</h2>
                            </div>
                            <address class="md-margin-bottom-40">
                                Twitter: <a class="element brand" href="http://twitter.com/@glasslu" target="_blank">@glasslu</a><br>
                                Email: <a class="element brand" href="mailto:hello@glass.lu">hello@glass.lu</a> <br />
                                M C Edwards Ltd trading as Glass<br />
                                Company No.:08641300 <br />
                            </address>
                        </div><!--/col-md-3-->
                        <!-- End Address -->
                    </div>
                </div>

            </div><!--/footer-->
        </div>
        <!-- 1/10/2019 8:47:53 AM -->
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '../www.google-analytics.com/analytics.html', 'ga');

            ga('create', 'UA-55731850-1', 'auto');
            ga('send', 'pageview');

        </script>


        <div class="footer-v1">

            <div class="copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <p>
                                2019 &copy; All Rights Reserved.
                            </p>
                        </div>
                        <div class="col-md-9">

                            <p>
                                <a href="../-/media/Files/Privacy_Policy_and_Cookie_Policy_Europe.pdf">Privacy Policy</a> | <a href="../-/media/Files/Website_TCs_Template.pdf">Terms and Conditions</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div><!--/copyright-->
        </div>

        <div class="hidden" id="perfResults">
            <li class="topbar-devider"></li>
            <li>
                <i class="fa fa-clock-o" title="Page Render Time"></i> 30
            </li>
            <li>
                <img src="content/icon-bbbbbb-16.html" title="Glass Time" style="width: 8px;"> 3
            </li>
            <li>
                <i class="fa fa-pencil-square-o" title="Glass items requested"></i> 13
            </li>
            <li>
                <i class="fa fa-cloud" title="Glass items from cache"></i> 10
            </li>
        </div>
        <script>
            (function ($) {

                $(function () {
                    var results = $("#perfResults");
                    var placeholder = $("#resultsReplaces");

                    var html = results.html();
                    placeholder.replaceWith(html);
                });
            })(jQuery);
        </script>




    </div>
</body>


<!-- Mirrored from glass.lu/blog/MixingInIoc by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:22:40 GMT -->
</html>