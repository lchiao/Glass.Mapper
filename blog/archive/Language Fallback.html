


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from www.glass.lu/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 10:13:45 GMT -->
<!-- Added by HTTrack -->

<!-- Mirrored from glass.lu/blog/archive/Language Fallback by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:26:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <link rel="stylesheet" href="../../content/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../content/css/style.css">
    <link rel="stylesheet" href="../../content/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../content/css/theme-colors/default.css">
    <link rel="stylesheet" href="../../content/plugins/sky-forms/version-2.0.1/css/custom-sky-forms.css">

    <link rel="stylesheet" href="../../content/plugins/parallax-slider/css/parallax-slider.css">

    <link rel="stylesheet" href="../../content/Site-Lessae52ae52.css?v=5" />
    <link rel="stylesheet" href="../../content/site.css">

    <title>Language Fallback - Glass</title>

    <link rel="shortcut icon" href="../../-/media/Images/Common/Horizon-Bordered-BlazeOrange-250.png">
    <!-- JS Global Compulsory -->
    <script type="text/javascript" src="../../content/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../content/plugins/jquery/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="../../content/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../../content/Site.js"></script>
    <script src="../google-code-prettify.googlecode.com/svn/loader/run_prettify.html"></script>
    <script type="text/javascript" src="../../content/plugins/parallax-slider/js/modernizr.js"></script>
    <script type="text/javascript" src="../../content/plugins/parallax-slider/js/jquery.cslider.js"></script>


</head>


<body class="metro  mvc ">

    <div class="wrapper">

        <div class="header header-sticky header-fixed-shrink">
            <div class="topbar">
            </div>

            <!-- Navbar -->
            <div class="navbar navbar-default mega-menu" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="fa fa-bars"></span>
                        </button>
                        <a class="navbar-brand" href="../../index.html">

                            <img src="../../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                            <span style="vertical-align: middle;">Glass</span>

                        </a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse navbar-responsive-collapse">
                        <ul class="nav navbar-nav">

                            <li class="">

                                <a href="../../Support.html">Support</a>
                            </li>
                            <li class="">

                                <a href="../../Training.html">Training</a>
                            </li>
                            <li class="">

                                <a href="../../Blog.html">Blog</a>
                            </li>
                            <li class="">

                                <a href="../../Mapper.html">Glass.Mapper.Sc</a>
                            </li>
                            <li class="">

                                <a href="../../Rockstars.html">Our Backers</a>
                            </li>
                            <li class="">

                                <a href="../../About.html">About</a>
                            </li>
                        </ul>
                    </div><!--/navbar-collapse-->
                </div>
            </div>
            <!-- End Navbar -->
        </div>

            <div class="breadcrumbs">
                <div class="container">
                    <h1 class="pull-left">

                        Language Fallback

                    </h1>

                </div><!--/container-->
            </div>

        


<div class="container content">
    <div class="row">
        
 

        
<div>
    
</div>
<div class="row">
    <div class="col-md-12">

        <div class="blog margin-bottom-40">
            <div class="blog-post-tags">
                <ul class="list-unstyled list-inline blog-info pull-right">
                    <li>
                        <h3>
                            <i class="fa fa-calendar"></i>
                            01 Jan 1970
                        </h3>
                    </li>

                        <li>
                            <h3>
                                <a href="../../About/Mike.html">
                                    <i class="fa fa-pencil"></i>
                                    Mike
                                </a>
                            </h3>
                        </li>
                </ul>
            </div>
        </div>
    </div>
</div>

            
    




<p class='lead'>This post has been migrated from <strong>www.experimentsincode.com</strong>, we apologise if some of the images or content is missing</p><strong>This is for Sitecore 5.3, there is an alternative <a href="http://www.experimentsincode.com/Blog/Post/using-a-default-language-in-sitecore-62">Sitecore 6 default language provider</a> </strong>

Imagine a site built in Sitecore that has multiple languages but not all  pages are translated into the different language. When a visitor to the  site visits a page that has not been translated they normally receive a  404 error. However you may not want this, instead you might want it to  use a default language instead. The user will no longer see a 404 error  but will have any missing content replaced by the default language.

There are two was to do this, we can either create our own set of  classes to wrap the XSLT extensions, XSLT controls and code references  or we can alter the way the data is pulled from the database. I have  decided to go with altering the data pulled from the database because  this is less work and easier to manage.

The way this solution works is that it checks every item pulled from the  database to see what language versions are available for that item. If  the item is missing a particular language it will then inject the  default language. If you are using SQL Server the class that does the  data pulling is called Sitecore.Data.SqlServer.SqlServerDataProvider and  can be found in Sitecore.SqlServer.dll. Using the decorator pattern we  inherit from this class like so:
<div>
<div>
<div><a onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">view plain</a><a onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;" href="http://www.experimentsincode.com/?page=5#">copy to clipboard</a><a onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">print</a><a onclick="dp.sh.Toolbar.Command('About',this);return false;" href="http://www.experimentsincode.com/?page=5#">?</a></div>
</div>
<ol>
	<li>publicÃ‚Â classÃ‚Â SqlServerDataProviderÃ‚Â :Ã‚Â Sitecore.Data.SqlServer.SqlServerDataProvider</li>
	<li>{</li>
	<li></li>
	<li> publicÃ‚Â SqlServerDataProvider(stringÃ‚Â connectionString)</li>
	<li> :Ã‚Â base(connectionString)</li>
	<li> {</li>
	<li> }</li>
	<li> protectedÃ‚Â overrideÃ‚Â voidÃ‚Â LoadItemFields(stringÃ‚Â itemCondition,Ã‚Â stringÃ‚Â fieldCondition,Ã‚Â object[]Ã‚Â parameters,Ã‚Â Sitecore.Collections.SafeDictionary&lt;ID,Ã‚Â Sitecore.Data.DataProviders.PrefetchData&gt;Ã‚Â prefetchData)</li>
	<li> {</li>
	<li> base.LoadItemFields(itemCondition,Ã‚Â fieldCondition,Ã‚Â parameters,Ã‚Â prefetchData);</li>
	<li></li>
	<li> //setÃ‚Â theÃ‚Â defaultÃ‚Â languageÃ‚Â toÃ‚Â use</li>
	<li> LanguageÃ‚Â defaultLang;</li>
	<li> Language.TryParse("en",Ã‚Â outÃ‚Â defaultLang);</li>
	<li></li>
	<li> //fullÃ‚Â listÃ‚Â ofÃ‚Â languagesÃ‚Â theÃ‚Â siteÃ‚Â uses</li>
	<li> LanguageCollectionÃ‚Â collÃ‚Â =Ã‚Â this.GetLanguages();</li>
	<li></li>
	<li> foreachÃ‚Â (varÃ‚Â dataÃ‚Â inÃ‚Â prefetchData)</li>
	<li> {</li>
	<li> ifÃ‚Â (data.ValueÃ‚Â !=Ã‚Â null)</li>
	<li> {</li>
	<li> varÃ‚Â urisÃ‚Â =Ã‚Â data.Value.GetVersionUris();</li>
	<li> //checkÃ‚Â theÃ‚Â itemÃ‚Â containsÃ‚Â theÃ‚Â defaultÃ‚Â languageÃ‚Â beforeÃ‚Â doingÃ‚Â anything</li>
	<li> ifÃ‚Â (uris.Cast&lt;VersionUri&gt;().Any(xÃ‚Â =&gt;Ã‚Â x.LanguageÃ‚Â ==Ã‚Â defaultLang))</li>
	<li> {</li>
	<li> //getÃ‚Â theÃ‚Â defaultÃ‚Â languageÃ‚Â fields</li>
	<li> varÃ‚Â defaultUriÃ‚Â =Ã‚Â uris.Cast&lt;VersionUri&gt;().First(xÃ‚Â =&gt;Ã‚Â x.LanguageÃ‚Â ==Ã‚Â defaultLang);</li>
	<li> //loopÃ‚Â throughÃ‚Â eachÃ‚Â language</li>
	<li> foreachÃ‚Â (LanguageÃ‚Â langÃ‚Â inÃ‚Â coll)</li>
	<li> {</li>
	<li> //checkÃ‚Â ifÃ‚Â languageÃ‚Â doesn'tÃ‚Â exist</li>
	<li> ifÃ‚Â (!uris.Cast&lt;VersionUri&gt;().Any(xÃ‚Â =&gt;Ã‚Â x.LanguageÃ‚Â ==Ã‚Â lang))</li>
	<li> {</li>
	<li> //updateÃ‚Â languageÃ‚Â withÃ‚Â defaultÃ‚Â languageÃ‚Â values</li>
	<li> FieldListÃ‚Â fieldsÃ‚Â =Ã‚Â data.Value.GetFieldList("en",Ã‚Â defaultUri.Version.Number);</li>
	<li> foreachÃ‚Â (varÃ‚Â fieldÃ‚Â inÃ‚Â fields)</li>
	<li> {</li>
	<li> data.Value.AddField(lang.Name,Ã‚Â 1,Ã‚Â field.Key,Ã‚Â field.Value);</li>
	<li> }</li>
	<li> }</li>
	<li> }</li>
	<li> }</li>
	<li> }</li>
	<li> }</li>
	<li> }</li>
	<li>}</li>
</ol>
</div>
<pre>    public class SqlServerDataProvider : Sitecore.Data.SqlServer.SqlServerDataProvider
    {

        public SqlServerDataProvider(string connectionString)
            : base(connectionString)
        {
        }
        protected override void LoadItemFields(string itemCondition, string fieldCondition, object[] parameters, Sitecore.Collections.SafeDictionary&lt;ID, Sitecore.Data.DataProviders.PrefetchData&gt; prefetchData)
        {
            base.LoadItemFields(itemCondition, fieldCondition, parameters, prefetchData);

            //set the default language to use
            Language defaultLang;
            Language.TryParse("en", out defaultLang);

            //full list of languages the site uses
            LanguageCollection coll = this.GetLanguages();

            foreach (var data in prefetchData)
            {
                if (data.Value != null)
                {
                    var uris = data.Value.GetVersionUris();
                    //check the item contains the default language before doing anything
                    if (uris.Cast&lt;VersionUri&gt;().Any(x =&gt; x.Language == defaultLang))
                    {
                        //get the default language fields
                        var defaultUri = uris.Cast&lt;VersionUri&gt;().First(x =&gt; x.Language == defaultLang);
                        //loop through each language
                        foreach (Language lang in coll)
                        {
                            //check if language doesn't exist
                            if (!uris.Cast&lt;VersionUri&gt;().Any(x =&gt; x.Language == lang))
                            {
                                //update language with default language values
                                FieldList fields = data.Value.GetFieldList("en", defaultUri.Version.Number);
                                foreach (var field in fields)
                                {
                                    data.Value.AddField(lang.Name, 1, field.Key, field.Value);
                                }
                            }
                        }
                    }
                }
            }
        }
    }</pre>
Now that we have our code we need to update the web.config to use our  new class. First we need to add our class as a new provider. Find the  following section in the Sitecore section of the web.config.
<div>
<div>
<div><a onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">view plain</a><a onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;" href="http://www.experimentsincode.com/?page=5#">copy to clipboard</a><a onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">print</a><a onclick="dp.sh.Toolbar.Command('About',this);return false;" href="http://www.experimentsincode.com/?page=5#">?</a></div>
</div>
<ol>
	<li>&lt;!--Ã‚Â DATAÃ‚Â PROVIDERSÃ‚Â --&gt;</li>
	<li>&lt;dataProviders&gt;</li>
	<li> &lt;mainÃ‚Â type="Sitecore.Data.$(database).$(database)DataProvider,Ã‚Â Sitecore.$(database)"&gt;--&gt;</li>
	<li> &lt;paramÃ‚Â ref="connections/$(1)"Ã‚Â /&gt;</li>
	<li> &lt;Name&gt;$(1)&lt;/Name&gt;</li>
	<li> &lt;/main&gt;</li>
</ol>
</div>
<pre>&lt;!-- DATA PROVIDERS --&gt;
&lt;dataProviders&gt;
	 &lt;main type="Sitecore.Data.$(database).$(database)DataProvider, Sitecore.$(database)"&gt;--&gt;
	 	 &lt;param ref="connections/$(1)" /&gt;
	 	 &lt;Name&gt;$(1)&lt;/Name&gt;
	 &lt;/main&gt;</pre>
Update it as shown below so that you now have two providers:
<div>
<div>
<div><a onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">view plain</a><a onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;" href="http://www.experimentsincode.com/?page=5#">copy to clipboard</a><a onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">print</a><a onclick="dp.sh.Toolbar.Command('About',this);return false;" href="http://www.experimentsincode.com/?page=5#">?</a></div>
</div>
<ol>
	<li>&lt;dataProviders&gt;</li>
	<li> &lt;mainÃ‚Â type="Sitecore.Data.$(database).$(database)DataProvider,Ã‚Â Sitecore.$(database)"&gt;--&gt;</li>
	<li> &lt;paramÃ‚Â ref="connections/$(1)"Ã‚Â /&gt;</li>
	<li> &lt;Name&gt;$(1)&lt;/Name&gt;</li>
	<li> &lt;/main&gt;</li>
	<li> &lt;webÃ‚Â type="Demo.Data.SqlServerDataProvider,Ã‚Â Demo"&gt;</li>
	<li> &lt;paramÃ‚Â ref="connections/$(1)"Ã‚Â /&gt;</li>
	<li> &lt;Name&gt;$(1)&lt;/Name&gt;</li>
	<li> &lt;/web&gt;</li>
</ol>
</div>
<pre>&lt;dataProviders&gt;
	 &lt;main type="Sitecore.Data.$(database).$(database)DataProvider, Sitecore.$(database)"&gt;--&gt;
	 	 &lt;param ref="connections/$(1)" /&gt;
	 	 &lt;Name&gt;$(1)&lt;/Name&gt;
	 &lt;/main&gt;
	 &lt;web type="Demo.Data.SqlServerDataProvider, Demo"&gt;
	 	 &lt;param ref="connections/$(1)" /&gt;
	 	 &lt;Name&gt;$(1)&lt;/Name&gt;
	 &lt;/web&gt;</pre>
We then just need to update the relevant databases to use this class. I  am assuming that only the web database will use this class. In which  case find the following section in the web.config:
<div>
<div>
<div><a onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">view plain</a><a onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;" href="http://www.experimentsincode.com/?page=5#">copy to clipboard</a><a onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">print</a><a onclick="dp.sh.Toolbar.Command('About',this);return false;" href="http://www.experimentsincode.com/?page=5#">?</a></div>
</div>
<ol>
	<li>&lt;databaseÃ‚Â id="web"Ã‚Â singleInstance="true"Ã‚Â type="Sitecore.Data.Database,Ã‚Â Sitecore.Kernel"&gt;</li>
	<li> &lt;paramÃ‚Â desc="name"&gt;$(id)&lt;/param&gt;</li>
	<li> &lt;securityEnabled&gt;true&lt;/securityEnabled&gt;</li>
	<li> &lt;dataProvidersÃ‚Â hint="list:AddDataProvider"&gt;</li>
	<li> &lt;dataProviderÃ‚Â ref="dataProviders/main"Ã‚Â param1="$(id)"&gt;</li>
</ol>
</div>
<pre> &lt;database id="web" singleInstance="true" type="Sitecore.Data.Database, Sitecore.Kernel"&gt;
	 &lt;param desc="name"&gt;$(id)&lt;/param&gt;
	 	 &lt;securityEnabled&gt;true&lt;/securityEnabled&gt;
	 	 &lt;dataProviders hint="list:AddDataProvider"&gt;
	 	 	 &lt;dataProvider ref="dataProviders/main" param1="$(id)"&gt;</pre>
Update the providers list to look like this:
<div>
<div><a onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">view plain</a><a onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;" href="http://www.experimentsincode.com/?page=5#">copy to clipboard</a><a onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;" href="http://www.experimentsincode.com/?page=5#">print</a><a onclick="dp.sh.Toolbar.Command('About',this);return false;" href="http://www.experimentsincode.com/?page=5#">?</a></div>
</div>
<ol>
	<li>&lt;databaseÃ‚Â id="web"Ã‚Â singleInstance="true"Ã‚Â type="Sitecore.Data.Database,Ã‚Â Sitecore.Kernel"&gt;</li>
	<li> &lt;paramÃ‚Â desc="name"&gt;$(id)&lt;/param&gt;</li>
	<li> &lt;securityEnabled&gt;true&lt;/securityEnabled&gt;</li>
	<li> &lt;dataProvidersÃ‚Â hint="list:AddDataProvider"&gt;</li>
	<li> &lt;dataProviderÃ‚Â ref="dataProviders/web"Ã‚Â param1="$</li>
</ol>

    

    </div>
</div>

        <div class="footer-v1">
            <div class="footer">
                <div class="container">
                    <div class="row">
                        <!-- About -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="row text-center margin-bottom-10 margin-top-20">
                                <a href="../../index.html" class="">
                                    <img src="../../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                                </a>
                            </div>

                            <p>Glass is home to the #1 ORM for Sitecore. Glass.Mapper is the easiest way to map data from your Sitecore solution to your code.</p>
                        </div><!--/col-md-3-->
                        <!-- End About -->
                        <!-- Latest -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Sponsored by</h2>
                            </div>
                            <a href="https://refractdns.com/">
                                <img src="../../-/media/Images/Tiles/RDNS_Logo_WithTextWhite.png" style="width: 100%" class="img-responsive">
                            </a>
                        </div><!--/col-md-3-->
                        <!-- End Latest -->
                        <!-- Link List -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Useful Links</h2>
                            </div>
                            <ul class="list-unstyled link-list">
                                <li><a href="../../Blog.html">Blog</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../../Training.html">Training</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../../Mapper.html">Glass.Mapper.Sc</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../../Support.html">Support</a><i class="fa fa-angle-right"></i></li>
                            </ul>
                        </div><!--/col-md-3-->
                        <!-- End Link List -->
                        <!-- Address -->
                        <div class="col-md-3 map-img md-margin-bottom-40">
                            <div class="headline">
                                <h2>Contact Us</h2>
                            </div>
                            <address class="md-margin-bottom-40">
                                Twitter: <a class="element brand" href="http://twitter.com/@glasslu" target="_blank">@glasslu</a><br>
                                Email: <a class="element brand" href="mailto:hello@glass.lu">hello@glass.lu</a> <br />
                                M C Edwards Ltd trading as Glass<br />
                                Company No.:08641300 <br />
                            </address>
                        </div><!--/col-md-3-->
                        <!-- End Address -->
                    </div>
                </div>

            </div><!--/footer-->
        </div>
        <!-- 1/10/2019 8:47:53 AM -->
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '../www.google-analytics.com/analytics.html', 'ga');

            ga('create', 'UA-55731850-1', 'auto');
            ga('send', 'pageview');

        </script>


        <div class="footer-v1">

            <div class="copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <p>
                                2019 &copy; All Rights Reserved.
                            </p>
                        </div>
                        <div class="col-md-9">

                            <p>
                                <a href="../../-/media/Files/Privacy_Policy_and_Cookie_Policy_Europe.pdf">Privacy Policy</a> | <a href="../../-/media/Files/Website_TCs_Template.pdf">Terms and Conditions</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div><!--/copyright-->
        </div>

        <div class="hidden" id="perfResults">
            <li class="topbar-devider"></li>
            <li>
                <i class="fa fa-clock-o" title="Page Render Time"></i> 30
            </li>
            <li>
                <img src="content/icon-bbbbbb-16.html" title="Glass Time" style="width: 8px;"> 3
            </li>
            <li>
                <i class="fa fa-pencil-square-o" title="Glass items requested"></i> 13
            </li>
            <li>
                <i class="fa fa-cloud" title="Glass items from cache"></i> 10
            </li>
        </div>
        <script>
            (function ($) {

                $(function () {
                    var results = $("#perfResults");
                    var placeholder = $("#resultsReplaces");

                    var html = results.html();
                    placeholder.replaceWith(html);
                });
            })(jQuery);
        </script>




    </div>
</body>


<!-- Mirrored from glass.lu/blog/archive/Language Fallback by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:26:11 GMT -->
</html>