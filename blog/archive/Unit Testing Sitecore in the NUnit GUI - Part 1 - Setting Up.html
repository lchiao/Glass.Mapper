


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from www.glass.lu/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 10:13:45 GMT -->
<!-- Added by HTTrack -->

<!-- Mirrored from glass.lu/blog/archive/Unit Testing Sitecore in the NUnit GUI - Part 1 - Setting Up by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:25:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <link rel="stylesheet" href="../../content/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../content/css/style.css">
    <link rel="stylesheet" href="../../content/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../content/css/theme-colors/default.css">
    <link rel="stylesheet" href="../../content/plugins/sky-forms/version-2.0.1/css/custom-sky-forms.css">

    <link rel="stylesheet" href="../../content/plugins/parallax-slider/css/parallax-slider.css">

    <link rel="stylesheet" href="../../content/Site-Lessae52ae52.css?v=5" />
    <link rel="stylesheet" href="../../content/site.css">

    <title>Unit Testing Sitecore in the NUnit GUI - Part 1 - Setting Up - Glass</title>

    <link rel="shortcut icon" href="../../-/media/Images/Common/Horizon-Bordered-BlazeOrange-250.png">
    <!-- JS Global Compulsory -->
    <script type="text/javascript" src="../../content/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../../content/plugins/jquery/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="../../content/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../../content/Site.js"></script>
    <script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script type="text/javascript" src="../../content/plugins/parallax-slider/js/modernizr.js"></script>
    <script type="text/javascript" src="../../content/plugins/parallax-slider/js/jquery.cslider.js"></script>


</head>


<body class="metro  mvc ">

    <div class="wrapper">

        <div class="header header-sticky header-fixed-shrink">
            <div class="topbar">
            </div>

            <!-- Navbar -->
            <div class="navbar navbar-default mega-menu" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="fa fa-bars"></span>
                        </button>
                        <a class="navbar-brand" href="../../index.html">

                            <img src="../../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                            <span style="vertical-align: middle;">Glass</span>

                        </a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse navbar-responsive-collapse">
                        <ul class="nav navbar-nav">

                            <li class="">

                                <a href="../../Support.html">Support</a>
                            </li>
                            <li class="">

                                <a href="../../Training.html">Training</a>
                            </li>
                            <li class="">

                                <a href="../../Blog.html">Blog</a>
                            </li>
                            <li class="">

                                <a href="../../Mapper.html">Glass.Mapper.Sc</a>
                            </li>
                            <li class="">

                                <a href="../../Rockstars.html">Our Backers</a>
                            </li>
                            <li class="">

                                <a href="../../About.html">About</a>
                            </li>
                        </ul>
                    </div><!--/navbar-collapse-->
                </div>
            </div>
            <!-- End Navbar -->
        </div>

            <div class="breadcrumbs">
                <div class="container">
                    <h1 class="pull-left">

                        Unit Testing Sitecore in the NUnit GUI - Part 1 - Setting Up

                    </h1>

                </div><!--/container-->
            </div>

        


<div class="container content">
    <div class="row">
        
 

        
<div>
    
</div>
<div class="row">
    <div class="col-md-12">

        <div class="blog margin-bottom-40">
            <div class="blog-post-tags">
                <ul class="list-unstyled list-inline blog-info pull-right">
                    <li>
                        <h3>
                            <i class="fa fa-calendar"></i>
                            30 Aug 2010
                        </h3>
                    </li>

                        <li>
                            <h3>
                                <a href="../../About/Mike.html">
                                    <i class="fa fa-pencil"></i>
                                    Mike
                                </a>
                            </h3>
                        </li>
                </ul>
            </div>
        </div>
    </div>
</div>

            <img src="../../-/media/Images/Blogs/Archive/ut-appconfig8a4c8a4c.jpg?h=83&amp;w=200&amp;la=en&amp;hash=DF90909FAD389C554401FB707A16270999E53663" class="pull-right img-responsive img-bordered margin-bottom-10 margin-left-10" alt="">
    




<p class='lead'>This post has been migrated from <strong>www.experimentsincode.com</strong>, we apologise if some of the images or content is missing</p>Posts in this series:
<ul>
	<li><a href="http://blog.experimentsincode.com/index.php/2010/08/30/232">Unit Testing Sitecore in the NUnit GUI Ã¢â‚¬â€œ Part 1 Ã¢â‚¬â€œ Setting Up</a></li>
	<li><a href="http://blog.experimentsincode.com/index.php/2010/09/01/247">Unit Testing Sitecore in the NUnit GUI Ã¢â‚¬â€œ Part 2 Ã¢â‚¬â€œ Writing Tests</a></li>
	<li><a href="http://blog.experimentsincode.com/index.php/2010/09/08/241">Unit Testing Sitecore in the NUnit GUI - Part 3 - Known Problems</a></li>
</ul>
I am currently working on a project that requires a lot of complex interaction with Sitecore, to be sure that it worked and so that future changes didn't break what I had written I wanted to unit test the Sitecore interaction. However this has always been quite tricky in Sitecore. Due to Sitecores tight coupling to the database and the configuration files I had avoid trying to get this to work, actually it turned out to be quite straight forward.

As I was try to get this to work with NUnit I received a <a href="http://twitter.com/aweber1/status/21937628625">tweet</a> about unit testing Sitecore by <a href="http://bit.ly/bBbyaL">Alistair Deneys</a> which performed the unit tests inside a web page on the site. I didn't want to follow this solution because I already had unit tests that were being performed in the NUnit GUI. However Alistair's solution does fill in some of the gaps left by this solution, you can see some of the advantages/disadvantages at the end of the post.

On to the important bit, the steps I took to get Sitecore working via NUnit, I will assume that you have a solution that has both a Website that contains the Sitecore solution and Class Library that contains your unit tests.
<ol>
	<li>Add the following references to the Class Library:
<ul>
	<li>log4net.dll</li>
	<li>Lucene.Net.dll</li>
	<li>NUnit.Framework.dll</li>
	<li>Sitecore.Kernal.dll</li>
	<li>Sitecore.Logging.dll</li>
	<li>Sitecore.Nexus.dll</li>
	<li>System.Configuration.dll</li>
</ul>
</li>
	<li>Add an App.config to the Class Library</li>
	<li>Open the Sitecore Web.config and copy the following section headers to the App.Config
<pre class="brush:xml">  &lt;configSections&gt;
    &lt;section name="sitecore" type="Sitecore.Configuration.ConfigReader, Sitecore.Kernel" /&gt;
    &lt;section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, Sitecore.Logging" /&gt;
  &lt;/configSections&gt;</pre>
</li>
	<li>Copy the following configuration sections from the Web.config into the App.config:
<ul>
	<li>connectionStrings</li>
	<li>appSettings</li>
	<li>sitecore</li>
	<li>log4net</li>
</ul>
</li>
	<li>Copy the App_Config directory from the website to the Class Library
<a href="../../s400290293.websitehome.co.uk/wp-content/uploads/2010/08/ut-appconfig.html"><img class="alignnone size-full wp-image-233" title="ut-appconfig" src="../../-/media/Images/Blogs/Archive/ut-appconfig21252125.jpg?la=en" alt="App Config copied to Class Library" width="315" height="130"></a></li>
	<li><a href="../../s400290293.websitehome.co.uk/wp-content/uploads/2010/08/ut-appconfig.html"></a>This is a bit of a longer step, for every file beneath the App_Config directory you need to change the "Copy to Output Directory" property to "Copy always".</li>
	<li>Next we need to update the App.config so that all references to files in the App_Config directory use a windows path rather than a URL. Open the App.Config and then using the Find and Replace tool, configured as show below. Note that we have changes the forward slashes to backslashes and that we have added a full stop to the start.
<a href="../../s400290293.websitehome.co.uk/wp-content/uploads/2010/08/ut-findandreplace.html"><img class="alignnone size-full wp-image-234" title="ut-findandreplace" src="../../-/media/Images/Blogs/Archive/ut-findandreplace21252125.jpg?la=en" alt="Find and replace configuration" width="352" height="312">
</a>Click "Replace All"</li>
	<li>Configure the class library to run NUnit once it has been built.</li>
</ol>
So we have now configured the Class Library for unit testing, next we need to be sure that everything works. For my test I wrote the following simple tests to ensure that everything was setup correctly:
<pre class="brush:c#">    [TestFixture]
    public class SetupTestFixture
    {
        [Test]
        public void DatabaseGet()
        {
            Database database = global::Sitecore.Configuration.Factory.GetDatabase("master");
            Assert.IsNotNull(database);
        }
        [Test]
        public void GetItem()
        {
            Database database = global::Sitecore.Configuration.Factory.GetDatabase("master");
            Assert.IsNotNull(database);

            Item item = database.GetItem("/sitecore/content");
            Assert.IsNotNull(item);
            Assert.AreEqual("content", item.Name);
        }
    }</pre>
I built and run the Class Library and launched NUnit, when the tests run the both pass:

<a href="../../s400290293.websitehome.co.uk/wp-content/uploads/2010/08/ut-nunitrun.html"><img class="alignnone size-full wp-image-235" title="ut-nunitrun" src="../../-/media/Images/Blogs/Archive/ut-nunitrun21252125.jpg?la=en" alt="Test run and passed in NUnit" width="305" height="102"></a>

For me this method has the following advantages:
<ul>
	<li>All my tests are within one testing application (NUnit Gui)</li>
	<li>As long as my build server can see my test database these test can be run as part of the build</li>
	<li>I can perform code coverage stats on these tests</li>
	<li>It will force a clearÃ‚Â separationÃ‚Â of presentation logic/business logic within my code (more Ã‚Â in a future post)</li>
	<li>Does not need to be run from within a web site</li>
	<li>Quick to setup</li>
	<li>Nice way to test business logic</li>
</ul>
These are some of the disadvantages/can't do's that I can think of at the moment.
<ul>
	<li>Can't use Sitecore.Context (I would argue that if you require this for a test then your code is written incorrectly)</li>
	<li>Can't test XSLT's, ASCX output</li>
	<li>If you want to use it on the build server then the build server has to be able to see the database</li>
	<li>No access to some of the pipelines (however you might be able to fire these manually)</li>
	<li>No HttpContext (again, if you need this to test you code then you code is probably incorrectly written</li>
	<li>Two sets of configuration files</li>
</ul>
I am sure there are more limitations and more advantages, as I continue to explore the limits of what can be performed via this method of unit testing, Ã‚Â I will add it to the blog as I find out.

I will write another blog in a couple of days that address how to structure code so that it can be unit tested via this method and how we can get around the problem on not having a Sitecore.Context.

    

    </div>
</div>

        <div class="footer-v1">
            <div class="footer">
                <div class="container">
                    <div class="row">
                        <!-- About -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="row text-center margin-bottom-10 margin-top-20">
                                <a href="../../index.html" class="">
                                    <img src="../../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                                </a>
                            </div>

                            <p>Glass is home to the #1 ORM for Sitecore. Glass.Mapper is the easiest way to map data from your Sitecore solution to your code.</p>
                        </div><!--/col-md-3-->
                        <!-- End About -->
                        <!-- Latest -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Sponsored by</h2>
                            </div>
                            <a href="https://refractdns.com/">
                                <img src="../../-/media/Images/Tiles/RDNS_Logo_WithTextWhite.png" style="width: 100%" class="img-responsive">
                            </a>
                        </div><!--/col-md-3-->
                        <!-- End Latest -->
                        <!-- Link List -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Useful Links</h2>
                            </div>
                            <ul class="list-unstyled link-list">
                                <li><a href="../../Blog.html">Blog</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../../Training.html">Training</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../../Mapper.html">Glass.Mapper.Sc</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../../Support.html">Support</a><i class="fa fa-angle-right"></i></li>
                            </ul>
                        </div><!--/col-md-3-->
                        <!-- End Link List -->
                        <!-- Address -->
                        <div class="col-md-3 map-img md-margin-bottom-40">
                            <div class="headline">
                                <h2>Contact Us</h2>
                            </div>
                            <address class="md-margin-bottom-40">
                                Twitter: <a class="element brand" href="http://twitter.com/@glasslu" target="_blank">@glasslu</a><br>
                                Email: <a class="element brand" href="mailto:hello@glass.lu">hello@glass.lu</a> <br />
                                M C Edwards Ltd trading as Glass<br />
                                Company No.:08641300 <br />
                            </address>
                        </div><!--/col-md-3-->
                        <!-- End Address -->
                    </div>
                </div>

            </div><!--/footer-->
        </div>
        <!-- 1/10/2019 8:47:53 AM -->
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '../www.google-analytics.com/analytics.html', 'ga');

            ga('create', 'UA-55731850-1', 'auto');
            ga('send', 'pageview');

        </script>


        <div class="footer-v1">

            <div class="copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <p>
                                2019 &copy; All Rights Reserved.
                            </p>
                        </div>
                        <div class="col-md-9">

                            <p>
                                <a href="../../-/media/Files/Privacy_Policy_and_Cookie_Policy_Europe.pdf">Privacy Policy</a> | <a href="../../-/media/Files/Website_TCs_Template.pdf">Terms and Conditions</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div><!--/copyright-->
        </div>

        <div class="hidden" id="perfResults">
            <li class="topbar-devider"></li>
            <li>
                <i class="fa fa-clock-o" title="Page Render Time"></i> 30
            </li>
            <li>
                <img src="content/icon-bbbbbb-16.html" title="Glass Time" style="width: 8px;"> 3
            </li>
            <li>
                <i class="fa fa-pencil-square-o" title="Glass items requested"></i> 13
            </li>
            <li>
                <i class="fa fa-cloud" title="Glass items from cache"></i> 10
            </li>
        </div>
        <script>
            (function ($) {

                $(function () {
                    var results = $("#perfResults");
                    var placeholder = $("#resultsReplaces");

                    var html = results.html();
                    placeholder.replaceWith(html);
                });
            })(jQuery);
        </script>




    </div>
</body>


<!-- Mirrored from glass.lu/blog/archive/Unit Testing Sitecore in the NUnit GUI - Part 1 - Setting Up by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:25:47 GMT -->
</html>