


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from www.glass.lu/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 10:13:45 GMT -->
<!-- Added by HTTrack -->

<!-- Mirrored from glass.lu/blog/2019-04-26-CacheAlwaysOn by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:21:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <link rel="stylesheet" href="../content/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../content/css/style.css">
    <link rel="stylesheet" href="../content/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../content/css/theme-colors/default.css">
    <link rel="stylesheet" href="../content/plugins/sky-forms/version-2.0.1/css/custom-sky-forms.css">

    <link rel="stylesheet" href="../content/plugins/parallax-slider/css/parallax-slider.css">

    <link rel="stylesheet" href="../Content/Site-Lessae52ae52.css?v=5" />
    <link rel="stylesheet" href="../content/site.css">

    <title>Caching Always On - Glass</title>

    <link rel="shortcut icon" href="../-/media/Images/Common/Horizon-Bordered-BlazeOrange-250.png">
    <!-- JS Global Compulsory -->
    <script type="text/javascript" src="../content/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../content/plugins/jquery/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="../content/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../Content/Site.js"></script>
    <script src="../google-code-prettify.googlecode.com/svn/loader/run_prettify.html"></script>
    <script type="text/javascript" src="../content/plugins/parallax-slider/js/modernizr.js"></script>
    <script type="text/javascript" src="../content/plugins/parallax-slider/js/jquery.cslider.js"></script>


</head>


<body class="metro  mvc ">

    <div class="wrapper">

        <div class="header header-sticky header-fixed-shrink">
            <div class="topbar">
            </div>

            <!-- Navbar -->
            <div class="navbar navbar-default mega-menu" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="fa fa-bars"></span>
                        </button>
                        <a class="navbar-brand" href="../index.html">

                            <img src="../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                            <span style="vertical-align: middle;">Glass</span>

                        </a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse navbar-responsive-collapse">
                        <ul class="nav navbar-nav">

                            <li class="">

                                <a href="../Support.html">Support</a>
                            </li>
                            <li class="">

                                <a href="../Training.html">Training</a>
                            </li>
                            <li class="">

                                <a href="../Blog.html">Blog</a>
                            </li>
                            <li class="">

                                <a href="../Mapper.html">Glass.Mapper.Sc</a>
                            </li>
                            <li class="">

                                <a href="../Rockstars.html">Our Backers</a>
                            </li>
                            <li class="">

                                <a href="../About.html">About</a>
                            </li>
                        </ul>
                    </div><!--/navbar-collapse-->
                </div>
            </div>
            <!-- End Navbar -->
        </div>

            <div class="breadcrumbs">
                <div class="container">
                    <h1 class="pull-left">

Blog -                         Caching Always On

                    </h1>

                </div><!--/container-->
            </div>

        


<div class="container content">
    <div class="row padding-bottom-20">
        <p>
            <strong>
                <a href="../blog-2.html">&lt;&lt; Back to Blogs</a>
            </strong>
        </p>
    </div>
    <div class="row">


        


<div class="row">
    <div class="col-md-12">

        <div class="blog margin-bottom-40">
            <div class="blog-post-tags">

                <ul class="list-unstyled list-inline blog-info pull-right">
                    <li>
                        <h3>
                            <i class="fa fa-calendar"></i>
                            26 April 2019
                        </h3>
                    </li>

                    <li>
                        <h3>
                            <a href="../About/Mike.html">
                                <i class="fa fa-pencil"></i>
                                Mike
                            </a>
                        </h3>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<a href="https://pixabay.com/photos/superbike-motorsport-fast-speed-930715/" target="_blank" class="pull-right">
    <img src="../Images/Blog/CacheAlwaysOnDetails.png" class=" img-responsive img-bordered margin-bottom-10 margin-left-10" alt="" style="height:300px">
    <p class="text-center">
        Make Your Solution Faster
    </p>
</a>

<p>
    A couple of months ago I announced a new Glass.Mapper.Sc feature called <a href="CacheAlwaysOn.html">Cache Always On</a>. This feature has now been released in
    version <a href="../Mapper/Releases.html">5.4.18</a> of Glass.Mapper.Sc and I wanted to dive into what this change means and how it works.
</p>

<h3>Beta Feature</h3>
<p>
    This feature is beta and we are looking for feedback. If you do enable cache always on please let us know about your experience.
</p>

<h3>Enabling Cache Always On</h3>
<p>
    By default Cache Always On is disabled and needs to be enabled in the Glass config as shown below:
</p>
<pre>
  public static  class GlassMapperScCustom
  {
		public static IDependencyResolver CreateResolver(){
			var config = new Glass.Mapper.Sc.Config();

            config.Cache.AlwaysOn = true;

			var dependencyResolver = new DependencyResolver(config);
			// add any changes to the standard resolver here
			return dependencyResolver;
		}
</pre>

<p>
    Once enabled this changes the tasks that are added to the object construction pipeline, swapping the SitecoreCacheCheckTask for the SitecoreCacheAlwaysOnCheckTask (exciting stuff!).
</p>

<h3>The Cache Is Always On</h3>

<p>
    Enabling cache always on causes a major change in the way that models are generated. As the name suggests the cache is now considered "on" for all models. So for example the following
    two requests for a model will both return the same cached instance:
</p>
<pre>
    var item1 = service.GetItem&lt;MyModel&gt;(path, x =&gt; x.CacheEnabled());
    var item2 = service.GetItem&lt;MyModel&gt;(path);
</pre>
<p>
    The cache can be explicitly avoided by setting the disabled flag:
</p>
<pre>
    var item1 = service.GetItem&lt;MyModel&gt;(path, x =&gt; x.CacheDisabled());
</pre>

<h3>Memory and Caching</h3>
<p>
    Since the cache is always enabled you will need to consider the memory usage of your models. If you have a large solution with a huge number of pages then the cache could become very large
    very quickly and cause memory pressures on your machine. If you enable cache always on you should monitor the memory consumption on your servers.
</p>
<p>
    Due to the way that the objects are added to the cache and the fact that each objects may have multiple references from other objects it isn't possible to
    evict single objects from the cache to reduce the amount of memory usage. Setting memory thresholds or expiration times may not actually remove an object
    from memory because other objects in the cache may have references to the object which will keep it alive.  The only way to reduce the memory consumption is to completely
    clear the cache.
</p>
<p>
    The cache itself is completely cleared after a Sitcore publish like the Sitecore HTML cache.
</p>
<p>
    Cache Always on also uses lazy loading and therefore proxy objects. This means that these cached objects can't be easily serialised for remote storage or transmission, therefore
    you will need to use a cache that stores the models in the servers memory and not in a remote shared cache, e.g. REDIS or similar.
</p>

<h3>Lazy Loading</h3>
<p>
    Cache always on takes advantages of the changes we made in V5 which allows the framework to support caching and lazy loading. You can now
    cache large object graphs but without the whole graph being loaded on the first request.
</p>
<p>
    This delayed loading of data into the cache should mean an increase in page first load performance and more flexibility for developers.
</p>
<p>
    To perform lazy loading Glass keeps the underlying ISitecoreService used to load the model alive as part of the proxy object. This means that the ISitecoreService
    lifecycle will live for an indeterminate amount of time and shouldn't be disposed by a IOC container to earlier.
</p>

<h3>
    IOC
</h3>
<p>
    As stated above the underlying ISitecoreService will now live for a indeterminate amount of time, therefore you should not register the ISitecoreService as having a per-request
    or scoped lifecycle.
</p>
<p>
    The ISitecoreService is a 1-1 wrapper for the underlying Sitecore Database and the Sitecore Database object itself is a singleton. It is therefore probably safe to register the
    ISitecoreService as a singleton itself. IOC registration is discussed in more detail as part of the <a href="https://training.glass.lu/">Glass.Mapper.Sc training course</a>.
</p>
<h3>SitecoreContext</h3>
<p>
    Cache Always on will not work with the class Glass.Mapper.Sc.SitecoreContext, if you enable this feature and use SitecoreContext you will receive an exception. You should replace
    the SitecoreContext class with one of the appropriate alternatives like MvcContext/RequestContext/WebFormsContext.
</p>


<h3>Feedback</h3>
<p>
    If you give Cache Always On please let us know how you get on. We are excited by this feature and look forward to hearing how it is used.
</p>
<p>
    <em>- Mike</em>
</p>

    </div>

    <div class="row">
        <div class="row">
    <div class="devider devider-dashed margin-top-30 margin-bottom-30"></div>

    <div class="col-md-8">

        <div class="headline">
            <h2 class="">Glass needs your support!</h2>
        </div>

        <p>
            Glass.Mappper.Sc is supported by the generous donations of the Glass.Mapper.Sc community! Their donations help fund the time, effort and hosting for the project.
        </p>
        <p>
            These supporters are <strong>AMAZING</strong> and a huge thank you to all of you. You can find our list of supporters on the <a href="../rockstars-2.html">Rockstars page</a>.
        </p>
        <p>
            If <strong>you</strong> use Glass.Mapper.Sc and find it useful please consider supporting the project. Not only will you help the project but you could also get a discount on the
            Glass.Mapper.Sc training and join the Rockstars page.
        </p>

        <p class="text-center">
            <a href="https://www.patreon.com/glassmappersc" class="btn-u btn-u-lg" style="margin: 10px;">
                <em class=" fa fa-star icon-bg-darker"></em>
                Become a Rockstar
            </a>
        </p>

    </div>
    <div class="col-md-4 text-center">
        <img src="../Images/Blog/WeNeedYou.jpg" style="max-height:300px"/>
    </div>
</div>

        </div>
    </div>


        <div class="footer-v1">
            <div class="footer">
                <div class="container">
                    <div class="row">
                        <!-- About -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="row text-center margin-bottom-10 margin-top-20">
                                <a href="../index.html" class="">
                                    <img src="../-/media/Images/Common/Horizon-Bordered-BlazeOrange-2503ca73ca7.png?h=50&amp;w=50&amp;la=en&amp;hash=C5F3C6D5FCB00EBE826D80BE26742A4D078D12D4" id="logo-header" alt="" />
                                </a>
                            </div>

                            <p>Glass is home to the #1 ORM for Sitecore. Glass.Mapper is the easiest way to map data from your Sitecore solution to your code.</p>
                        </div><!--/col-md-3-->
                        <!-- End About -->
                        <!-- Latest -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Sponsored by</h2>
                            </div>
                            <a href="https://refractdns.com/">
                                <img src="../-/media/Images/Tiles/RDNS_Logo_WithTextWhite.png" style="width: 100%" class="img-responsive">
                            </a>
                        </div><!--/col-md-3-->
                        <!-- End Latest -->
                        <!-- Link List -->
                        <div class="col-md-3 md-margin-bottom-40">
                            <div class="headline">
                                <h2>Useful Links</h2>
                            </div>
                            <ul class="list-unstyled link-list">
                                <li><a href="../Blog.html">Blog</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../Training.html">Training</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../Mapper.html">Glass.Mapper.Sc</a><i class="fa fa-angle-right"></i></li>
                                <li><a href="../Support.html">Support</a><i class="fa fa-angle-right"></i></li>
                            </ul>
                        </div><!--/col-md-3-->
                        <!-- End Link List -->
                        <!-- Address -->
                        <div class="col-md-3 map-img md-margin-bottom-40">
                            <div class="headline">
                                <h2>Contact Us</h2>
                            </div>
                            <address class="md-margin-bottom-40">
                                Twitter: <a class="element brand" href="http://twitter.com/@glasslu" target="_blank">@glasslu</a><br>
                                Email: <a class="element brand" href="mailto:hello@glass.lu">hello@glass.lu</a> <br />
                                M C Edwards Ltd trading as Glass<br />
                                Company No.:08641300 <br />
                            </address>
                        </div><!--/col-md-3-->
                        <!-- End Address -->
                    </div>
                </div>

            </div><!--/footer-->
        </div>
        <!-- 1/10/2019 8:47:53 AM -->
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '../www.google-analytics.com/analytics.html', 'ga');

            ga('create', 'UA-55731850-1', 'auto');
            ga('send', 'pageview');

        </script>


        <div class="footer-v1">

            <div class="copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <p>
                                2019 &copy; All Rights Reserved.
                            </p>
                        </div>
                        <div class="col-md-9">

                            <p>
                                <a href="../-/media/Files/Privacy_Policy_and_Cookie_Policy_Europe.pdf">Privacy Policy</a> | <a href="../-/media/Files/Website_TCs_Template.pdf">Terms and Conditions</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div><!--/copyright-->
        </div>

        <div class="hidden" id="perfResults">
            <li class="topbar-devider"></li>
            <li>
                <i class="fa fa-clock-o" title="Page Render Time"></i> 30
            </li>
            <li>
                <img src="content/icon-bbbbbb-16.html" title="Glass Time" style="width: 8px;"> 3
            </li>
            <li>
                <i class="fa fa-pencil-square-o" title="Glass items requested"></i> 13
            </li>
            <li>
                <i class="fa fa-cloud" title="Glass items from cache"></i> 10
            </li>
        </div>
        <script>
            (function ($) {

                $(function () {
                    var results = $("#perfResults");
                    var placeholder = $("#resultsReplaces");

                    var html = results.html();
                    placeholder.replaceWith(html);
                });
            })(jQuery);
        </script>




    </div>
</body>


<!-- Mirrored from glass.lu/blog/2019-04-26-CacheAlwaysOn by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 24 May 2021 11:21:43 GMT -->
</html>